<!--
$PostgreSQL: pgsql/doc/src/sgml/ref/pg_dumpall.sgml,v 1.48 2005/01/06 18:29:08 tgl Exp $
PostgreSQL documentation
-->

<refentry id="APP-PG-DUMPALL">
 <refmeta>
  <refentrytitle id="APP-PG-DUMPALL-TITLE"><application>pg_dumpall</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Aplicação</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_dumpall</refname>
  <refpurpose>salva os bancos de dados de um agrupamento do <productname>PostgreSQL</productname> em um arquivo de script</refpurpose>
 </refnamediv>

 <indexterm zone="app-pg-dumpall">
  <primary>pg_dumpall</primary>
 </indexterm>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_dumpall</command>
   <arg rep="repeat"><replaceable>opção</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1 id="app-pg-dumpall-description">
  <title>Descrição</title>

  <para>
   O <application>pg_dumpall</application> é um utilitário para salvar
   (<literal>dump</literal>) todos os bancos de dados de um agrupamento do
   <productname>PostgreSQL</productname> em um arquivo de script.
   O arquivo de script contém comandos <acronym>SQL</acronym> que podem ser
   usados como entrada do <xref linkend="app-psql"> para restaurar os bancos
   de dados.
   Isto é feito chamando o <xref linkend="app-pgdump"> para cada banco de dados
   do agrupamento.
   O <application>pg_dumpall</application> também salva os objetos globais,
   comuns a todos os bancos de dados
   (O <application>pg_dump</application> não salva estes objetos).
   Atualmente são incluídas informações sobre os usuários do banco de dados e
   grupos, e permissões de acesso aplicadas aos bancos de dados como um todo.
  </para>

  <para>
   Portanto, o <application>pg_dumpall</application> é uma solução integrada
   para realizar cópias de segurança dos bancos de dados.
   Entretanto, deve ser observada a seguinte limitação: não é possível salvar
   <quote>objetos grandes</quote>, porque o <application>pg_dump</application>
   não pode salvar estes objetos em arquivos texto.
   Havendo bancos de dados contendo objetos grandes, estes devem ser salvos
   usando um dos modos de saída não-texto do <application>pg_dump</application>.
  </para>

  <para>
   Como o <application>pg_dumpall</application> lê tabelas de todos
   os bancos de dados, muito provavelmente será necessário se conectar como
   um superusuário para poder gerar uma cópia completa. Também será
   necessário o privilégio de superusuário para executar o script produzido,
   para poder criar usuários e grupos, e para poder criar os bancos de dados.
  </para>

  <para>
   O script SQL é escrito na saída padrão. Devem ser usados
   operadores de linha de comando para redirecionar para um arquivo.
  </para>

  <para>
   O <application>pg_dumpall</application> precisa se conectar várias vezes ao
   servidor <productname>PostgreSQL</productname> (uma vez para cada banco de
   dados). Se for utilizada autenticação por senha, provavelmente será
   solicitada a senha cada uma destas vezes.
   Neste caso é conveniente existir o arquivo <filename>~/.pgpass</filename>.
   Consulte a <xref linkend="libpq-pgpass"> para obter informações adicionais.
  </para>

 </refsect1>

 <refsect1>
  <title>Opções</title>

   <para>
    As seguintes opções de linha de comando controlam
    o conteúdo e o formato da saída:

    <variablelist>
     <varlistentry>
      <term><option>-a</option></term>
      <term><option>--data-only</option></term>
      <listitem>
       <para>
        Salva somente os dados, não salva o esquema (definições de dado).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-c</option></term>
      <term><option>--clean</option></term>
      <listitem>
       <para>
        Inclui comandos para remover (<literal>drop</literal>) os objetos
        do banco de dados antes dos comandos para criá-los.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-d</option></term>
      <term><option>--inserts</option></term>
      <listitem>
       <para>
        Salva os dados como comandos <command>INSERT</command>,
        em vez de <command>COPY</command>. Torna a restauração muito lenta;
        sua utilização principal é para fazer cópias de segurança que possam
        ser carregadas em outros bancos de dados que não o
        <productname>PostgreSQL</productname>.
        Deve ser observado que a restauração pode falhar inteiramente se a
        ordem das colunas tiver sido modificada.
        A opção <option>-D</option> é mais segura, mas ainda mais lenta.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-D</option></term>
      <term><option>--column-inserts</option></term>
      <term><option>--attribute-inserts</option></term>
      <listitem>
       <para>
        Salva os dados como comandos <command>INSERT</command>
        explicitando os nomes das colunas (<literal>INSERT INTO
        <replaceable>tabela</replaceable>
        (<replaceable>coluna</replaceable>, ...) VALUES
        ...</literal>). Torna a restauração muito lenta;
        sua utilização principal é para fazer cópias de segurança que possam
        ser carregadas em outros bancos de dados que não o
        <productname>PostgreSQL</productname>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-g</option></term>
      <term><option>--globals-only</option></term>
      <listitem>
       <para>
        Salva somente os objetos globais (usuários e grupos),
        e não os banco de dados.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-i</option></term>
      <term><option>--ignore-version</option></term>
      <listitem>
       <para>
        Ignora a diferença de versão entre o <application>pg_dump</application>
        e o servidor de banco de dados.
       </para>

       <para>
        O <application>pg_dump</application> pode tratar bancos de dados
        de versões anteriores do <productname>PostgreSQL</productname>, mas as
        versões muito antigas não são mais suportadas (atualmente as anteriores
        a 7.0). Esta opção deve ser utilizada se for necessário desconsiderar a
        verificação de versão (mas se o <application>pg_dumpall</application>
        não for bem-sucedido, não diga que não foi avisado).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o</option></term>
      <term><option>--oids</option></term>
      <listitem>
       <para>
        Salva os identificadores de objeto (<acronym>OID</acronym>s) de todas as
        tabelas como parte dos dados. Esta opção deve ser usada quando a coluna
        OID é referenciada de alguma maneira (por exemplo, em uma restrição de
        chave estrangeira). Caso contrário, esta opção não deve ser usada.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-O</option></term>
      <term><option>--no-owner</option></term>
      <listitem>
       <para>
        Não gera comandos para definir o dono dos objetos
        correspondendo ao do banco de dados original. Por padrão, o
        <application>pg_dump</application> emite os comandos
        <command>ALTER OWNER</command> ou
        <command>SET SESSION AUTHORIZATION</command>
        para definir o dono dos objetos de bancos de dados criados.
        Estes comandos não são bem-sucedidos quando o script é executado,
        a menos que o script seja executado por um superusuário
        (ou o mesmo usuário que possui todos os objetos presentes no script).
        Para gerar um script que possa ser restaurado por qualquer usuário, mas
        que torna este usuário o dono de todos os objetos, deve ser
        especificada a opção <option>-O</option>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-s</option></term>
      <term><option>--schema-only</option></term>
      <listitem>
       <para>
        Salva somente o esquema (definições dos dados), não os dados.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-S <replaceable class="parameter">nome_do_usuário</replaceable></option></term>
      <term><option>--superuser=<replaceable class="parameter">nome_do_usuário</replaceable></option></term>
      <listitem>
       <para>
        Especifica o nome de usuário do superusuário a ser usado para
        desabilitar os gatilhos. Somente é relevante quando é usado
        <option>--disable-triggers</option>
        (Geralmente é melhor não utilizar esta opção e, em vez disso,
        executar o script produzido como um superusuário).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-v</option></term>
      <term><option>--verbose</option></term>
      <listitem>
       <para>
        Especifica o modo verboso, fazendo o <application>pg_dump</application>
        colocar os tempos de início/fim no arquivo de cópia de segurança, e
        mensagens de progresso na saída de erro padrão.
        Também habilita a saída verbosa no <application>pg_dump</application>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-x</option></term>
      <term><option>--no-privileges</option></term>
      <term><option>--no-acl</option></term>
      <listitem>
       <para>
        Impede salvar os privilégios de acessos (comandos GRANT/REVOKE).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-X disable-dollar-quoting</option></term>
      <term><option>--disable-dollar-quoting</option></term>
      <listitem>
       <para>
        Esta opção desabilita a utilização do caractere cifrão
        (<literal>$</literal>) para delimitar o corpo das funções, obrigando a
        utilização da sintaxe para cadeia de caracteres do padrão SQL.
       </para>
     </listitem>
    </varlistentry>

     <varlistentry>
      <term><option>-X disable-triggers</option></term>
      <term><option>--disable-triggers</option></term>
      <listitem>
       <para>
        Esta opção somente é relevante ao criar um arquivo de cópia de segurança
        somente de dados. Faz o <application>pg_dumpall</application> incluir
        comandos para desabilitar, temporariamente, os gatilhos das tabelas de
        destino enquanto os dados são recarregados. Deve ser utilizado quando
        existem verificações de integridade referencial, ou outros gatilhos nas
        tabelas, que não se deseja que sejam chamados durante a recarga dos dados.
       </para>

       <para>
        Atualmente, os comandos emitidos para a opção
        <option>--disable-triggers</option> devem ser executados por
        superusuários. Portanto, também deve ser especificado o nome de um
        superusuário com a opção <option>-S</option> ou, de preferência,
        executar, com cuidado, o script produzido como um superusuário.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-X use-set-session-authorization</option></term>
      <term><option>--use-set-session-authorization</option></term>
      <listitem>
       <para>
        Gera comandos SET SESSION AUTHORIZATION do padrão SQL em vez dos
        comandos OWNER TO. Isto torna a cópia de segurança mais compatível com o
        padrão, mas dependendo da disposição dos objetos na cópia de segurança
        pode não restaurar de forma apropriada.
       </para>
      </listitem>
     </varlistentry>

    </variablelist>
   </para>

  <para>
    As seguintes opções de linha de comando controlam os parâmetros de conexão
    com o servidor de banco de dados:

   <variablelist>
     <varlistentry>
      <term>-h <replaceable>máquina</replaceable></term>
      <listitem>
       <para>
        Especifica o nome da máquina onde o servidor
        está executando. Se o nome iniciar por uma barra (/) é usado
        como o diretório do soquete do domínio Unix. O padrão é obter o nome a
        partir da variável de ambiente <envar>PGHOST</envar>, se esta estiver
        definida, senão tentar uma conexão pelo soquete do domínio Unix.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-p <replaceable>porta</replaceable></term>
      <listitem>
       <para>
        Especifica a porta TCP, ou a extensão de arquivo do soquete
        do domínio Unix local, onde o servidor está atendendo as conexões.
        O padrão é obter o valor a partir da variável de ambiente
        <envar>PGPORT</envar>, se esta estiver definida, senão usar o valor
        padrão compilado.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-U <replaceable>nome_do_usuário</replaceable></term>
      <listitem>
       <para>
        Conectar como o usuário especificado.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-W</term>
      <listitem>
       <para>
        Força a solicitação da senha, o que deve acontecer automaticamente
        quando o servidor requer autenticação por senha.
       </para>
      </listitem>
     </varlistentry>
   </variablelist>
  </para>
 </refsect1>


 <refsect1>
  <title>Ambiente</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGHOST</envar></term>
    <term><envar>PGPORT</envar></term>
    <term><envar>PGUSER</envar></term>

    <listitem>
     <para>
      Parâmetros de conexão padrão.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>


 <refsect1>
  <title>Observações</title>

  <para>
   Como o <application>pg_dumpall</application> chama o
   <application>pg_dump</application> internamente, algumas mensagens
   de diagnósticos se referem ao <application>pg_dump</application>.
  </para>

  <para>
   Ao término da restauração, é aconselhável executar o comando
   <command>ANALYZE</command> em todos os bancos de dados para que o otimizador
   tenha estatísticas úteis. Também pode ser executado
   <command>vacuumdb -a -z</command> para analisar todos os bancos de dados.
  </para>

 </refsect1>


 <refsect1 id="app-pg-dumpall-ex">
  <title>Exemplos</title>
  <para>
   Para salvar todos bancos de dados:

<screen>
<prompt>$</prompt> <userinput>pg_dumpall &gt; db.out</userinput>
</screen>
  </para>

  <para>
   Para recarregar este banco de dados deve ser utilizado, por exemplo:
<screen>
<prompt>$</prompt> <userinput>psql -f db.out template1</userinput>
</screen>
   (Neste caso o banco de dados a se conectar não tem importância, porque o
   arquivo de script criado pelo <application>pg_dumpall</application>
   contém os comandos apropriados para criar e conectar aos
   bancos de dados salvos).
  </para>
 </refsect1>

 <refsect1>
  <title>Consulte também</title>

  <para>
    <xref linkend="app-pgdump">. Veja aí os detalhes sobre
    as condições de erro possíveis.
  </para>
 </refsect1>

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
