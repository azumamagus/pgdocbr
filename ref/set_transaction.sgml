<!-- $PostgreSQL: pgsql/doc/src/sgml/ref/set_transaction.sgml,v 1.24 2006/07/31 01:10:56 alvherre Exp $ -->
<refentry id="SQL-SET-TRANSACTION">
 <refmeta>
  <refentrytitle id="SQL-SET-TRANSACTION-TITLE">SET TRANSACTION</refentrytitle>
  <refmiscinfo>SQL - Comandos da Linguagem</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>SET TRANSACTION</refname>
  <refpurpose>define as características da transação corrente</refpurpose>
 </refnamediv>

 <indexterm zone="sql-set-transaction">
  <primary>SET TRANSACTION</primary>
 </indexterm>

 <refsynopsisdiv>
<synopsis>
SET TRANSACTION <replaceable class="parameter">modo_da_transação</replaceable> [, ...]
SET SESSION CHARACTERISTICS AS TRANSACTION <replaceable class="parameter">modo_da_transação</replaceable> [, ...]

onde <replaceable class="parameter">modo_da_transação</replaceable> é um entre:

    ISOLATION LEVEL { SERIALIZABLE | REPEATABLE READ | READ COMMITTED | READ UNCOMMITTED }
    READ WRITE | READ ONLY
</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Descrição</title>

  <para>
   O comando <command>SET TRANSACTION</command> define as características da
   transação corrente. Não produz nenhum efeito para as transações subseqüentes.
   O comando <command>SET SESSION CHARACTERISTICS</command> define o padrão das
   características das transações para as próximas transações na sessão.
   Estes padrões podem ser mudados pelo comando
   <command>SET TRANSACTION</command> para uma transação individual.
  </para>

  <para>
   As características de transação disponíveis são o nível de
   isolamento da transação e o modo de acesso da transação
   (ler/escrever ou somente para leitura).
  </para>

  <para>
   O nível de isolamento de uma transação determina quais dados a transação pode
   ver quando outras transações estão processando concorrentemente.

   <variablelist>
    <varlistentry>
     <term><literal>READ COMMITTED</literal></term>
     <listitem>
      <para>
       A declaração consegue ver apenas as linhas efetivadas
       (<literal>commit</literal>) antes do início da sua execução.
       Este é o padrão.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><literal>SERIALIZABLE</literal></term>
     <listitem>
      <para>
       Todos os comandos da transação corrente podem ver apenas as linhas
       efetivadas antes da primeira consulta ou comando de modificação de dados
       ter sido executado nesta transação.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>

   O padrão SQL define dois níveis adicionais, <literal>READ
   UNCOMMITTED</literal> e <literal>REPEATABLE READ</literal>.
   No <productname>PostgreSQL</productname> <literal>READ
   UNCOMMITTED</literal> é tratado como
   <literal>READ COMMITTED</literal>, enquanto <literal>REPEATABLE
   READ</literal> é tratado como <literal>SERIALIZABLE</literal>.
  </para>

  <para>
   O nível de isolamento da transação não pode ser mudado após a primeira
   consulta ou comando de modificação de dado da transação
   (<command>SELECT</command>, <command>INSERT</command>,
   <command>DELETE</command>, <command>UPDATE</command>,
   <command>FETCH</command> ou <command>COPY</command>) ter sido executado.
   Consulte o <xref linkend="mvcc"> para obter informações adicionais sobre o
   isolamento de transações e controle de simultaneidade.
  </para>

  <para>
   O modo de acesso da transação determina se a transação lê e escreve, ou se
   é somente para leitura.
   Ler e escrever é o padrão.
   Quando a transação é somente para leitura, os seguintes comandos SQL
   não são permitidos:
   <literal>INSERT</literal>, <literal>UPDATE</literal>,
   <literal>DELETE</literal> e <literal>COPY FROM</literal> se a tabela
   a ser escrita não for uma tabela temporária;
   todos os comandos <literal>CREATE</literal>, <literal>ALTER</literal> e
   <literal>DROP</literal>;
   <literal>COMMENT</literal>, <literal>GRANT</literal>,
   <literal>REVOKE</literal>, <literal>TRUNCATE</literal>;
   também <literal>EXPLAIN ANALYZE</literal> e <literal>EXECUTE</literal> se o
   comando a ser executado está entre os listados.
   Esta é uma noção de somente para leitura de alto nível, que não impede
   escritas no disco.
  </para>
 </refsect1>

 <refsect1>
  <title>Observações</title>

  <para>
   Se for executado o comando <command>SET TRANSACTION</command> sem ser
   executado antes o comando <command>START TRANSACTION</command> ou
   <command>BEGIN</command>, vai ficar parecendo que este não causou nenhum
   efeito, uma vez que a transação termina imediatamente.
  </para>

  <para>
   É possível não utilizar o comando <command>SET TRANSACTION</command>,
   especificando o
   <replaceable class="parameter">modo_da_transação</replaceable> desejado no
   <command>BEGIN</command> ou no <command>START TRANSACTION</command>.
  </para>

  <para>
   Os modos de transação padrão da sessão também podem ser definidos através dos
   parâmetros de configuração <xref linkend="guc-default-transaction-isolation">
   e <xref linkend="guc-default-transaction-read-only">
   (De fato, <command>SET SESSION CHARACTERISTICS</command> é apenas uma forma
   verbosa equivalente a definir estas variáveis com <command>SET</command>).
   Isto significa que os valores padrão podem ser definidos no arquivo de
   configuração, via <command>ALTER DATABASE</command>, etc.
   Consulte a <xref linkend="runtime-config"> para obter informações adicionais.
  </para>
 </refsect1>

 <refsect1 id="R1-SQL-SET-TRANSACTION-3">
  <title>Compatibilidade</title>

  <para>
   Os dois comandos estão definidos no padrão <acronym>SQL</acronym>.
   No padrão <acronym>SQL</acronym> <literal>SERIALIZABLE</literal> é o nível de
   isolamento padrão; no <productname>PostgreSQL</productname> normalmente
   o padrão é <literal>READ COMMITTED</literal>, mas pode ser mudado conforme
   mencionado acima.
   Devido à falta de bloqueio de predicado, o nível
   <literal>SERIALIZABLE</literal> não é verdadeiramente serializável.
   Consulte o <xref linkend="mvcc"> para obter detalhes.
  </para>

  <para>
   No padrão SQL existe uma outra característica de transação que pode ser
   definida por estes comandos: o tamanho da área de diagnósticos.
   Este conceito só se aplica à linguagem SQL incorporada e, portanto, não é
   implementado no servidor <productname>PostgreSQL</productname>.
  </para>

  <para>
   O padrão SQL requer a presença de vírgulas entre os
   <replaceable class="parameter">modo_da_transação</replaceable> sucessivos,
   mas por razões históricas o <productname>PostgreSQL</productname>
   permite a omissão destas vírgulas.
  </para>
 </refsect1>
</refentry>
